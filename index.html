<!DOCTYPE html>
<html>

    <head>

        <title>Movement System</title>
        <meta charset="utf-8">

        <style>

            #canvas{
                position: absolute;
            }

        </style>

        <script type="text/javascript">
        
            window.onload = main;
            var mapMatrix = [];
            var playerPosition = [4, 4];
            var c, ctx;
            var grass1Texture, grass2Texture, grass3Texture, grass4Texture, grass5Texture, grass6Texture, grass7Texture, stone1Texture, stone2Texture, stone3Texture, brick1Texture, sfTexture, sbTexture, srTexture, slTexture, activePlayerTexture;

            const MAPWIDTH = 256;
            const MAPHEIGHT = 256;
            const RENDERWIDTH = 29;
            const RENDERHEIGHT = 13;
            const TILESIZE = 64;

            function moveCharacter(direction){

                var directionalTextures = [sbTexture, slTexture, sfTexture, srTexture];
                activePlayerTexture = directionalTextures[direction];
                var newPlayerPosition = [];

                if(direction%2 == 0){
                    newPlayerPosition = [playerPosition[0], playerPosition[1] + (direction - 1)];
                }else{
                    newPlayerPosition = [playerPosition[0] + (direction - 2), playerPosition[1]];
                }

                if(newPlayerPosition[0] >= 0 && newPlayerPosition[0] < MAPWIDTH && newPlayerPosition[1] >= 0 && newPlayerPosition[1] < MAPHEIGHT){
                    if(!mapMatrix[newPlayerPosition[1]][newPlayerPosition[0]].solid){
                        playerPosition = newPlayerPosition;
                    }
                }

                renderMap();

            }

            function renderMap(){

                if(playerPosition[0] < Math.ceil(RENDERWIDTH/2)){
                    var renderMinX = 0;
                }else if(playerPosition[0] > MAPWIDTH - Math.ceil(RENDERWIDTH/2)){
                    var renderMinX = MAPWIDTH - RENDERWIDTH;
                }else{
                    var renderMinX = playerPosition[0] - Math.floor(RENDERWIDTH/2);
                }

                if(playerPosition[1] < Math.ceil(RENDERHEIGHT/2)){
                    var renderMinY = 0;
                }else if(playerPosition[1] > MAPHEIGHT - Math.ceil(RENDERHEIGHT/2)){
                    var renderMinY = MAPHEIGHT - RENDERHEIGHT;
                }else{
                    var renderMinY = playerPosition[1] - Math.floor(RENDERHEIGHT/2);
                }

                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, c.width, c.height);
                
                for(var i = 0;i < RENDERHEIGHT;i++){
                    for(var j = 0;j < RENDERWIDTH;j++){
                        ctx.drawImage(mapMatrix[renderMinY + i][renderMinX + j].texture, j * TILESIZE, i * TILESIZE, TILESIZE, TILESIZE);
                    }
                }

                ctx.drawImage(activePlayerTexture, (playerPosition[0] - renderMinX) * TILESIZE, (playerPosition[1]  - renderMinY) * TILESIZE, TILESIZE, TILESIZE);

            }

            function main(){

                grass1Texture = getEl("grass1");
                grass2Texture = getEl("grass2");
                grass3Texture = getEl("grass3");
                grass4Texture = getEl("grass4");
                grass5Texture = getEl("grass5");
                grass6Texture = getEl("grass6");
                grass7Texture = getEl("grass7");
                stone1Texture = getEl("stone1");
                stone2Texture = getEl("stone2");
                stone3Texture = getEl("stone3");
                brick1Texture = getEl("brick1");

                sfTexture = getEl("sf");
                sbTexture = getEl("sb");
                slTexture = getEl("sl");
                srTexture = getEl("sr");
                activePlayerTexture = sfTexture;

                c = getEl("canvas");
                c.height = TILESIZE * RENDERHEIGHT;
                c.width = TILESIZE * RENDERWIDTH;
                c.style.top = "calc(50% - " + c.height/2 + "px)";
                c.style.left = "calc(50% - " + c.width/2 + "px)";
                ctx = c.getContext("2d");

                for(var y = 0;y < MAPHEIGHT;y++){
                    mapMatrix.push([]);
                    for(var x = 0;x < MAPWIDTH;x++){
                        mapMatrix[y].push([]);
                        for(var i = 0;i < MAPWIDTH;i++){
                            if(((x + 4)%8 == 0 && ((y%8 == 0) && y)) || ((y + 4)%8 == 0 && ((x%8 == 0) && x))){
                                mapMatrix[y][x] = {
                                    "solid": false,
                                    "texture": grass3Texture
                                };
                            }else if(x == 0 || x == MAPWIDTH-1 || y == 0 || y == MAPHEIGHT-1 || y%8 == 0 || x%8 == 0){
                                mapMatrix[y][x] = {
                                    "solid": true,
                                    "texture": stone1Texture
                                };
                            }else{
                                mapMatrix[y][x] = {
                                    "solid": false,
                                    "texture": grass7Texture
                                };
                            }
                        }
                    }
                }

                renderMap();

                window.addEventListener("keydown", function(e){

                    if(e.keyCode == 87 || e.keyCode == 38){
                        moveCharacter(0);
                    }else if(e.keyCode == 65 || e.keyCode == 37){
                        moveCharacter(1);
                    }else if(e.keyCode == 83 || e.keyCode == 40){
                        moveCharacter(2);
                    }else if(e.keyCode == 68 || e.keyCode == 39){
                        moveCharacter(3);
                    }

                    renderMap();

                });

            }

            function getEl(id){return document.getElementById(String(id));}

        </script>

    </head>

    <body style="overflow:hidden;">

        <canvas id="canvas"></canvas>

        <div id="textures" style="display: none;">
        
            <img id="stone1" src="stone1.webp"/>
            <img id="stone2" src="stone2.webp"/>
            <img id="stone2" src="stone3.webp"/>
            <img id="grass1" src="grass1.webp"/>
            <img id="grass2" src="grass2.webp"/>
            <img id="grass3" src="grass3.webp"/>
            <img id="grass4" src="grass4.webp"/>
            <img id="grass5" src="grass5.webp"/>
            <img id="grass6" src="grass6.webp"/>
            <img id="grass7" src="grass7.webp"/>
            <img id="brick1" src="brick1.webp"/>

            <img id="sf" src="sf.webp"/>
            <img id="sb" src="sb.webp"/>
            <img id="sr" src="sr.webp"/>
            <img id="sl" src="sl.webp"/>
            
        </div>

    </body>

</html>