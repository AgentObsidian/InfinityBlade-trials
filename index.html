<!DOCTYPE html>
<html>

    <head>

        <title>Movement System</title>
        <meta charset="utf-8">

        <style>

            #canvas{
                position: absolute;
            }

        </style>

        <script type="text/javascript">
        
            window.onload = main;
            var mapMatrix = [];
            var playerPosition = [0, 0];
            var c, ctx;
            var grassTexture;

            const MAPWIDTH = 256;
            const MAPHEIGHT = 256;
            const RENDERWIDTH = 29;
            const RENDERHEIGHT = 13;
            const TILESIZE = 64;

            function renderMap(){

                if(playerPosition[0] < Math.ceil(RENDERWIDTH/2)){
                    var renderMinX = 0;
                }else if(playerPosition[0] > MAPWIDTH - Math.ceil(RENDERWIDTH/2)){
                    var renderMinX = MAPWIDTH - RENDERWIDTH;
                }else{
                    var renderMinX = playerPosition[0] - Math.floor(RENDERWIDTH/2);
                }

                if(playerPosition[1] < Math.ceil(RENDERHEIGHT/2)){
                    var renderMinY = 0;
                }else if(playerPosition[1] > MAPHEIGHT - Math.ceil(RENDERHEIGHT/2)){
                    var renderMinY = MAPHEIGHT - RENDERHEIGHT;
                }else{
                    var renderMinY = playerPosition[1] - Math.floor(RENDERHEIGHT/2);
                }

                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, c.width, c.height);
                
                for(var i = 0;i < RENDERHEIGHT;i++){
                    for(var j = 0;j < RENDERWIDTH;j++){
                        if(((i + renderMinY) == playerPosition[1]) && ((j + renderMinX) == playerPosition[0])){
                            ctx.fillStyle = "green";
                            ctx.fillRect(j * TILESIZE, i * TILESIZE, TILESIZE, TILESIZE);
                        }else if(mapMatrix[renderMinY + i][renderMinX + j]){
                            ctx.fillStyle = "blue";
                            ctx.fillRect(j * TILESIZE, i * TILESIZE, TILESIZE, TILESIZE);
                        }else{
                            ctx.drawImage(grassTexture, j * TILESIZE, i * TILESIZE, TILESIZE, TILESIZE);
                        }
                    }
                }

            }

            function main(){

                grassTexture = new Image(TILESIZE, TILESIZE);
                grassTexture.src = "grass7.webp";
                grassTexture.onload = function(){

                c = getEl("canvas");
                c.height = TILESIZE * RENDERHEIGHT;
                c.width = TILESIZE * RENDERWIDTH;
                c.style.top = "calc(50% - " + c.height/2 + "px)";
                c.style.left = "calc(50% - " + c.width/2 + "px)";
                ctx = c.getContext("2d");

                for(var y = 0;y < MAPHEIGHT;y++){
                    mapMatrix.push([]);
                    for(var x = 0;x < MAPWIDTH;x++){
                        mapMatrix[y].push([]);
                        for(var i = 0;i < MAPWIDTH;i++){
                            mapMatrix[y][x] = 0;
                        }
                    }
                }

                renderMap();

                window.addEventListener("keydown", function(e){

                    if(e.keyCode == 87 || e.keyCode == 38){
                        if(playerPosition[1] != 0) playerPosition[1] = playerPosition[1] - 1;
                    }else if(e.keyCode == 65 || e.keyCode == 37){
                        if(playerPosition[0] != 0) playerPosition[0] = playerPosition[0] - 1;
                    }else if(e.keyCode == 83 || e.keyCode == 40){
                        if(playerPosition[1] != MAPHEIGHT - 1) playerPosition[1] = playerPosition[1] + 1;
                    }else if(e.keyCode == 68 || e.keyCode == 39){
                        if(playerPosition[0] != MAPWIDTH - 1) playerPosition[0] = playerPosition[0] + 1;
                    }

                    renderMap();

                });

                }

            }

            function getEl(id){return document.getElementById(String(id));}

        </script>

    </head>

    <body style="overflow:hidden;">

        <canvas id="canvas"></canvas>

        <canvas id="textureCanvas" style="display:none;"></canvas>

    </body>

</html>